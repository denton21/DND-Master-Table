<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Кампания</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Кампания</h1>
  
  <!-- Панель для учета золота -->
  <section id="gold-tracker" class="card">
    <h2><i class="fas fa-coins"></i> Золото</h2>
    <div class="gold-container">
      <div class="gold-display">
        <span id="gold-amount">0</span>
        <span class="gold-icon"><i class="fas fa-coins"></i></span>
      </div>
      <div class="gold-controls">
        <input type="text" id="gold-input" placeholder="+5 или -2..." aria-label="Изменить количество золота">
        <button onclick="updateGold(); playSound('coin-sound.mp3')">
          <i class="fas fa-check"></i> Обновить
        </button>
      </div>
    </div>
  </section>
  
  <button onclick="window.location.href='combat.html'; playSound('button-click.mp3')">
    <i class="fas fa-sword"></i> Управление боем
  </button>

  <section>
    <h2>Персонажи игроков</h2>
    <table id="pcs-table">
      <tr>
        <th><i class="fas fa-user"></i> Имя</th>
        <th><i class="fas fa-heart"></i> Максимум хитов</th>
        <th><i class="fas fa-shield-alt"></i> Класс доспехов</th>
        <th><i class="fas fa-bolt"></i> Паровые заряды</th> <!-- Новый столбец -->
        <th><i class="fas fa-backpack"></i> Инвентарь</th>
        <th><i class="fas fa-cog"></i> Действия</th>
      </tr>
    </table>
    <button onclick="addRow('pcs-table'); playSound('add-swipe.mp3')">
      <i class="fas fa-plus"></i> Добавить персонажа
    </button>
  </section>

  <section>
    <h2>Монстры</h2>
    <table id="monsters-table">
      <tr>
        <th><i class="fas fa-user"></i> Имя</th>
        <th><i class="fas fa-heart"></i> Максимум хитов</th>
        <th><i class="fas fa-shield-alt"></i> Класс доспехов</th>
        <th><i class="fas fa-bolt"></i> Паровые заряды</th> <!-- Новый столбец -->
        <th><i class="fas fa-backpack"></i> Инвентарь</th>
        <th><i class="fas fa-cog"></i> Действия</th>
      </tr>
    </table>
    <button onclick="addRow('monsters-table'); playSound('add-swipe.mp3')">
      <i class="fas fa-plus"></i> Добавить монстра
    </button>
  </section>

  <script>
    function playSound(soundFile) {
      const audio = new Audio(`sounds/${soundFile}`);
      audio.play().catch(error => console.log("Ошибка воспроизведения звука:", error));
    }

    function addRow(tableId) {
      const table = document.getElementById(tableId);
      const row = table.insertRow();
      row.classList.add('card', 'fade-in');
      const nameCell = row.insertCell();
      const maxHpCell = row.insertCell();
      const acCell = row.insertCell();
      const steamChargesCell = row.insertCell(); // Новый столбец
      const inventoryCell = row.insertCell();
      const actionCell = row.insertCell();

      nameCell.contentEditable = true;
      maxHpCell.contentEditable = true;
      acCell.contentEditable = true;
      steamChargesCell.contentEditable = true; // Новый столбец редактируемый
      inventoryCell.contentEditable = true;

      const deleteButton = document.createElement('button');
      deleteButton.innerHTML = '<i class="fas fa-trash"></i> Удалить';
      deleteButton.onclick = () => {
        playSound('delete.mp3');
        row.classList.add('fade-out');
        setTimeout(() => row.remove(), 300);
        saveData();
      };
      actionCell.appendChild(deleteButton);

      saveData();
    }

    function saveData() {
      const tables = ['pcs-table', 'monsters-table'];
      tables.forEach(tableId => {
        const table = document.getElementById(tableId);
        const data = [];
        for (let i = 1; i < table.rows.length; i++) {
          const row = table.rows[i];
          const rowData = [];
          for (let j = 0; j < row.cells.length - 1; j++) {
            rowData.push(row.cells[j].innerText);
          }
          data.push(rowData);
        }
        localStorage.setItem(tableId, JSON.stringify(data));
      });
      
      // Сохраняем текущее значение золота
      const goldAmount = document.getElementById('gold-amount').innerText;
      localStorage.setItem('gold-amount', goldAmount);
    }

    // Функция для обновления количества золота
    function updateGold() {
      const goldInput = document.getElementById('gold-input');
      const goldAmount = document.getElementById('gold-amount');
      
      let currentGold = parseInt(goldAmount.innerText) || 0;
      const inputValue = goldInput.value.trim();
      
      if (inputValue === '') return;
      
      if (inputValue.startsWith('+')) {
        // Если ввод начинается с +, добавляем значение
        const addValue = parseInt(inputValue.substring(1));
        if (!isNaN(addValue)) {
          currentGold += addValue;
        }
      } else if (inputValue.startsWith('-')) {
        // Если ввод начинается с -, вычитаем значение
        const subValue = parseInt(inputValue.substring(1));
        if (!isNaN(subValue)) {
          currentGold -= subValue;
        }
      } else {
        // Если это просто число, заменяем текущее значение
        const newValue = parseInt(inputValue);
        if (!isNaN(newValue)) {
          currentGold = newValue;
        }
      }
      
      // Обновляем отображение и сохраняем
      goldAmount.innerText = currentGold;
      goldInput.value = '';
      saveData();
      
      // Анимация изменения
      const goldDisplay = document.querySelector('.gold-display');
      goldDisplay.classList.add('gold-updated');
      setTimeout(() => {
        goldDisplay.classList.remove('gold-updated');
      }, 500);
    }
    
    // Обработка нажатия Enter в поле ввода золота
    document.addEventListener('DOMContentLoaded', function() {
      const goldInput = document.getElementById('gold-input');
      goldInput.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
          updateGold();
          playSound('coin-sound.mp3');
        }
      });
    });

    window.onload = () => {
      ['pcs-table', 'monsters-table'].forEach(tableId => {
        const table = document.getElementById(tableId);
        const savedData = JSON.parse(localStorage.getItem(tableId) || '[]');
        savedData.forEach(rowData => {
          const row = table.insertRow();
          row.classList.add('card', 'fade-in');
          const nameCell = row.insertCell();
          const maxHpCell = row.insertCell();
          const acCell = row.insertCell();
          const steamChargesCell = row.insertCell(); // Новый столбец
          const inventoryCell = row.insertCell();
          const actionCell = row.insertCell();

          nameCell.innerText = rowData[0] || '';
          maxHpCell.innerText = rowData[1] || '';
          acCell.innerText = rowData[2] || '';
          steamChargesCell.innerText = rowData[3] || ''; // Загружаем данные
          inventoryCell.innerText = rowData[4] || '';

          nameCell.contentEditable = true;
          maxHpCell.contentEditable = true;
          acCell.contentEditable = true;
          steamChargesCell.contentEditable = true; // Новый столбец редактируемый
          inventoryCell.contentEditable = true;

          const deleteButton = document.createElement('button');
          deleteButton.innerHTML = '<i class="fas fa-trash"></i> Удалить';
          deleteButton.onclick = () => {
            playSound('delete.mp3');
            row.classList.add('fade-out');
            setTimeout(() => row.remove(), 300);
            saveData();
          };
          actionCell.appendChild(deleteButton);
        });
      });

      document.querySelectorAll('td[contenteditable]').forEach(cell => {
        cell.addEventListener('input', saveData);
      });
      
      // Загружаем сохраненное значение золота
      const savedGold = localStorage.getItem('gold-amount');
      if (savedGold !== null) {
        document.getElementById('gold-amount').innerText = savedGold;
      }
    };
  </script>
</body>
</html>